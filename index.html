<!--
 * @Author: wuziyang 764401855@qq.com
 * @Date: 2025-07-16 16:04:16
 * @LastEditors: wuziyang 764401855@qq.com
 * @LastEditTime: 2025-07-16 17:35:38
 * @FilePath: \0716\index.html
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>容容兔专属抽奖系统</title>
  </head>
  <body>
    <body>
      <div style="margin: auto" id="my-lucky"></div>
      <button
        id="openModalBtn"
        style="
          display: block;
          margin: 20px auto;
          padding: 10px 28px;
          font-size: 18px;
          background: #ffb84c;
          color: #fff;
          border: none;
          border-radius: 24px;
          box-shadow: 0 2px 8px #0001;
          cursor: pointer;
          transition: background 0.2s;
        "
      >
        神秘代码
      </button>
      <!-- 弹窗结构 -->
      <div
        id="myModal"
        style="
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(0, 0, 0, 0.3);
          z-index: 1000;
          justify-content: center;
          align-items: center;
        "
      >
        <div
          style="
            background: #fff;
            padding: 30px 20px 24px 20px;
            border-radius: 14px;
            min-width: 260px;
            box-shadow: 0 4px 24px #0003;
            text-align: center;
          "
        >
          <input
            id="modalInput"
            type="text"
            placeholder="请输入神秘代码"
            style="
              width: 80%;
              padding: 10px 12px;
              margin-bottom: 18px;
              font-size: 16px;
              border: 1.5px solid #ffd580;
              border-radius: 8px;
              outline: none;
              box-shadow: 0 1px 4px #ffd58033;
              transition: border 0.2s;
            "
            onfocus="this.style.borderColor='#ffb84c'"
            onblur="this.style.borderColor='#ffd580'"
          />
          <br />
          <button
            id="confirmModalBtn"
            style="
              padding: 8px 32px;
              font-size: 16px;
              background: #ffb84c;
              color: #fff;
              border: none;
              border-radius: 20px;
              box-shadow: 0 2px 8px #ffd58077;
              cursor: pointer;
              transition: background 0.2s;
            "
          >
            确认
          </button>
        </div>
      </div>
      <!-- 自定义消息弹窗结构 -->
      <div id="messageBox" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.2);z-index:2000;justify-content:center;align-items:center;">
        <div style="background:#fff;padding:24px 30px 18px 30px;border-radius:14px;min-width:220px;box-shadow:0 4px 24px #0003;text-align:center;">
          <div id="messageBoxImg" style="margin-bottom:12px;"></div>
          <div id="messageBoxText" style="font-size:17px;color:#d64737;margin-bottom:18px;"></div>
          <button id="messageBoxBtn" style="padding:7px 28px;font-size:15px;background:#ffb84c;color:#fff;border:none;border-radius:18px;box-shadow:0 2px 8px #ffd58077;cursor:pointer;transition:background 0.2s;">确定</button>
        </div>
      </div>
      <script src="./app.js"></script>
      <script>
        // 自定义消息弹窗函数，支持图片
        function showMessageBox(msg, cb, imgSrc) {
          const box = document.getElementById('messageBox');
          const text = document.getElementById('messageBoxText');
          const btn = document.getElementById('messageBoxBtn');
          const imgDiv = document.getElementById('messageBoxImg');
          text.innerText = msg;
          if (imgSrc) {
            imgDiv.innerHTML = `<img src="${imgSrc}" style="max-width:120px;max-height:120px;border-radius:10px;box-shadow:0 2px 8px #ffd58077;" />`;
          } else {
            imgDiv.innerHTML = '';
          }
          box.style.display = 'flex';
          btn.onclick = function() {
            box.style.display = 'none';
            if (typeof cb === 'function') cb();
          };
        }
        // 设置奖品
        const prizes = [];
        let data = [
          "1元红包",
          "100元红包",
          "0.5元红包",
          "2元红包",
          "10元红包",
          "50元红包",
          "神秘大礼",
          "5元红包",
        ];
        data.forEach((item, index) => {
          prizes.push({
            title: item,
            background: index % 2 ? "#f9e3bb" : "#f8d384",
            fonts: [{ text: item, top: "10%" }],
            imgs: [{ src: `./img/${index}.png`, width: "30%", top: "35%" }],
          });
        });
        // 创建大转盘抽奖
        let luckyWheel = new LuckyCanvas.LuckyWheel(
          {
            el: "#my-lucky",
            width: "300px",
            height: "300px",
          },
          {
            prizes: prizes,
            defaultStyle: {
              fontColor: "#d64737",
              fontSize: "14px",
              margin: "auto",
            },
            blocks: [{ padding: "13px", background: "#d64737" }],
            buttons: [
              { radius: "50px", background: "#d64737" },
              { radius: "45px", background: "#fff" },
              { radius: "41px", background: "#f6c66f", pointer: true },
              {
                radius: "35px",
                background: "#ffdea0",
                imgs: [{ src: "./img/button.png", width: "65%", top: "-50%" }],
              },
            ],
            start() {
              if (localStorage.num == 1) return showMessageBox("你已经抽过奖了哦！");
              luckyWheel.play();
              setTimeout(() => {
                let index = (Math.random() * 8) >> 0; // 默认抽奖位置
                if (!localStorage.num) {
                  localStorage.num = 1;
                }
                if (localStorage.num != 2) {
                  while (index == 6) {
                    index = (Math.random() * 8) >> 0;
                  }
                }
                luckyWheel.stop(localStorage.num == 2 ? 6 : index);
                localStorage.num = localStorage.num + 1;
                // luckyWheel.stop((Math.random() * 8) >> 0);
              }, 3000);
            },
            end(prize) {
              showMessageBox(`恭喜你获得${prize.title}`, null, prize.imgs && prize.imgs[0] ? prize.imgs[0].src : undefined);
            },
          }
        );

        // 弹窗逻辑
        const openModalBtn = document.getElementById("openModalBtn");
        const myModal = document.getElementById("myModal");
        const confirmModalBtn = document.getElementById("confirmModalBtn");
        openModalBtn.onclick = function () {
          myModal.style.display = "flex";
        };
        confirmModalBtn.onclick = function () {
          const modalInput = document.getElementById("modalInput");
          if (modalInput.value.trim() === "") {
            showMessageBox("请输入内容");
            return;
          }
          if (modalInput.value.trim() === "我爱老公") {
            showMessageBox("老公也爱你哟~");
            localStorage.num = 2;
          }
          myModal.style.display = "none";
        };

        // 按钮悬停效果
        document.addEventListener("DOMContentLoaded", function () {
          const openBtn = document.getElementById("openModalBtn");
          const confirmBtn = document.getElementById("confirmModalBtn");
          openBtn.onmouseover = function () {
            this.style.background = "#ffa500";
          };
          openBtn.onmouseout = function () {
            this.style.background = "#ffb84c";
          };
          confirmBtn.onmouseover = function () {
            this.style.background = "#ffa500";
          };
          confirmBtn.onmouseout = function () {
            this.style.background = "#ffb84c";
          };
        });
      </script>
    </body>
  </body>
</html>
